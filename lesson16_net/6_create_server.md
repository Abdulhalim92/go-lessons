# Сервер в Go и стандартная библиотека для создания сервера

Go предоставляет мощные средства для создания серверов с использованием стандартной
библиотеки `net/http`. Эта библиотека упрощает создание HTTP-серверов и обработку 
входящих HTTP-запросов. В этом разделе мы рассмотрим, как создать простой HTTP-сервер в
Go и как использовать стандартные инструменты для обработки запросов и формирования
ответов.

## Основы создания HTTP-сервера в Go

Создание HTTP-сервера в Go включает несколько простых шагов:

1. Определение функций-обработчиков, которые будут обрабатывать HTTP-запросы.
2. Настройка маршрутов, связывающих URL-пути с соответствующими обработчиками.
3. Запуск сервера с использованием функции `http.ListenAndServe`.

### Простой HTTP-сервер в Go

В следующем примере показано, как создать базовый HTTP-сервер, который будет прослушивать
порт `8080` и обрабатывать запросы к корневому пути (`/`).

```go
package main

import (
	"fmt"
	"net/http"
)

// Обработчик HTTP-запросов
func handler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "Привет, это мой HTTP-сервер на Go!")
}

func main() {
	// Установка маршрута и обработчика
	http.HandleFunc("/", handler)

	// Запуск HTTP-сервера на порту 8080
	fmt.Println("Сервер запущен на http://localhost:8080")
	http.ListenAndServe(":8080", nil)
}
```

### Как работает пример

1. **Обработчик HTTP-запросов**: Функция `handler` определена для обработки всех 
HTTP-запросов, поступающих на корневой путь (`/`). Эта функция принимает два параметра:
    - `w http.ResponseWriter` — интерфейс для записи данных в ответ клиенту.
    - `r *http.Request` — объект запроса, содержащий информацию о запросе клиента.

2. **Настройка маршрута**: Функция `http.HandleFunc` связывает путь `/` с
функцией-обработчиком `handler`.

3. **Запуск HTTP-сервера**: `http.ListenAndServe` запускает сервер, прослушивающий порт
`8080`. Если второй аргумент функции — `nil`, используется стандартный `DefaultServeMux`
для маршрутизации запросов.

### Обработка различных HTTP-методов

В Go можно обрабатывать различные HTTP-методы, такие, как GET, POST, PUT, DELETE и другие,
используя стандартную библиотеку `net/http`. В следующем примере сервер обрабатывает как
GET, так и POST-запросы:

```go
package main

import (
	"fmt"
	"net/http"
)

// Обработчик HTTP-запросов
func handler(w http.ResponseWriter, r *http.Request) {
	if r.Method == http.MethodGet {
		fmt.Fprintf(w, "Получен GET-запрос")
	} else if r.Method == http.MethodPost {
		fmt.Fprintf(w, "Получен POST-запрос")
	} else {
		http.Error(w, "Метод не поддерживается", http.StatusMethodNotAllowed)
	}
}

func main() {
	// Установка маршрута и обработчика
	http.HandleFunc("/", handler)

	// Запуск HTTP-сервера на порту 8080
	fmt.Println("Сервер запущен на http://localhost:8080")
	http.ListenAndServe(":8080", nil)
}
```

### Как работает пример

1. **Проверка HTTP-метода**: Внутри функции-обработчика `handler` проверяется метод 
запроса с использованием `r.Method`. В зависимости от метода, сервер отправляет разные
ответы.
2. **Обработка ошибок**: Если метод не поддерживается, сервер возвращает HTTP-ошибку
405 "Method Not Allowed".

### Обработка статических файлов

HTTP-сервер в Go также может обслуживать статические файлы (например, HTML, CSS,
изображения). Для этого используется функция `http.FileServer`.

**Пример обработки статических файлов:**

```go
package main

import (
	"net/http"
)

func main() {
	// Создание обработчика для статических файлов из директории "static"
	fs := http.FileServer(http.Dir("./static"))

	// Настройка маршрута для статических файлов
	http.Handle("/static/", http.StripPrefix("/static/", fs))

	// Запуск HTTP-сервера на порту 8080
	http.ListenAndServe(":8080", nil)
}
```

### Как работает пример

1. **Создание обработчика файлов**: `http.FileServer` создает обработчик для статических
файлов, которые находятся в директории `./static`.
2. **Маршрутизация запросов**: `http.Handle` связывает путь `/static/` с обработчиком
файлов. `http.StripPrefix` используется для удаления префикса из URL перед передачей 
запроса обработчику файлов.

## Заключение

Стандартная библиотека `net/http` в Go предоставляет мощные и гибкие инструменты для 
создания HTTP-серверов. С помощью этой библиотеки можно легко обрабатывать различные
HTTP-методы, маршрутизировать запросы, обслуживать статические файлы и многое другое.
Это делает Go отличным выбором для разработки веб-приложений и микросервисов.
